schema: '2.0'
stages:
  fetch-metadata:
    cmd: python scripts/fetch_eidc_metadata.py data/eidc_metadata.json
    deps:
    - path: scripts/fetch_eidc_metadata.py
      hash: md5
      md5: 53d620665448ef91f2deedb517e2f502
      size: 675
    outs:
    - path: data/eidc_metadata.json
      hash: md5
      md5: b4f3774a2921debb4d7740165ac604d4
      size: 12157676
  prepare:
    cmd: python scripts/extract_metadata.py data/eidc_metadata.json data/extracted_metadata.json
    deps:
    - path: data/eidc_metadata.json
      hash: md5
      md5: 423dc3a61ede72e1d5c818d74277c0b4
      size: 12140491
    - path: scripts/extract_metadata.py
      hash: md5
      md5: c2fa7d2c4b8f28a6e24536ce0df244fd
      size: 1296
    outs:
    - path: data/extracted_metadata.json
      hash: md5
      md5: 7d2ae8d6a41a960592f30496eb498af7
      size: 4578493
  extract-metadata:
    cmd: python scripts/extract_metadata.py data/eidc_metadata.json data/extracted_metadata.json
    deps:
    - path: data/eidc_metadata.json
      hash: md5
      md5: b4f3774a2921debb4d7740165ac604d4
      size: 12157676
    - path: scripts/extract_metadata.py
      hash: md5
      md5: 3f0269a6413845f4425af55e7cea7bf8
      size: 1304
    outs:
    - path: data/extracted_metadata.json
      hash: md5
      md5: 789fda7a14f9a85c6ee0e10af8170a95
      size: 4584498
  chunk-data:
    cmd: python scripts/chunk_data.py -o data/chunked_data.json -c 300 -ol 100 -s
      10 data/extracted_metadata.json
    deps:
    - path: data/extracted_metadata.json
      hash: md5
      md5: 789fda7a14f9a85c6ee0e10af8170a95
      size: 4584498
    - path: data/supporting-docs.json
      hash: md5
      md5: 0febface6f1d23fda46c11bef65284f4
      size: 34
    - path: scripts/chunk_data.py
      hash: md5
      md5: 681528e4aa1dc8cfb5fe5e5472e25fdf
      size: 2509
    outs:
    - path: data/chunked_data.json
      hash: md5
      md5: e9160d8c6c0fa7f647c5baa03bd1b5dd
      size: 14947
  create-embeddings:
    cmd: python scripts/create_embeddings.py data/chunked_data.json data/embeddings.json
    deps:
    - path: data/chunked_data.json
      hash: md5
      md5: e9160d8c6c0fa7f647c5baa03bd1b5dd
      size: 14947
    - path: scripts/create_embeddings.py
      hash: md5
      md5: 4649c700dfae922b43b3608ee4f00c1a
      size: 808
    outs:
    - path: data/embeddings.json
      hash: md5
      md5: b08299369d1f243eb8d8ffa2cdb9a90f
      size: 351126
  upload-to-docstore:
    cmd: python scripts/upload_to_docstore.py data/embeddings.json -o data/chroma-data
      -em all-MiniLM-L6-v2 -c eidc-data
    deps:
    - path: data/embeddings.json
      hash: md5
      md5: b08299369d1f243eb8d8ffa2cdb9a90f
      size: 351126
    - path: scripts/upload_to_docstore.py
      hash: md5
      md5: 41da88e3bb6d2592bee938ce347f6983
      size: 1905
    outs:
    - path: data/chroma-data
      hash: md5
      md5: 6e5431dd6f6ec33877e8f9d4da166d83.dir
      size: 2069220
      nfiles: 5
  run-rag-pipeline:
    cmd: python scripts/run_rag_pipeline.py data/eidc_rag_test_sample.csv data/evaluation_data.csv
      data/chroma-data -c eidc-data
    deps:
    - path: data/chroma-data
      hash: md5
      md5: 6e5431dd6f6ec33877e8f9d4da166d83.dir
      size: 2069220
      nfiles: 5
    - path: data/eidc_rag_test_sample.csv
      hash: md5
      md5: a371d83c5822d256286e80d64d58c3fe
      size: 7524
    - path: scripts/run_rag_pipeline.py
      hash: md5
      md5: 8d5fc0669771146562c773186f4f44f6
      size: 3667
    outs:
    - path: data/evaluation_data.csv
      hash: md5
      md5: f6bce3f5c551e84da224d36201858839
      size: 6638
  generate-testset:
    cmd: cp data/synthetic-datasets/eidc_rag_test_sample.csv data/
    outs:
    - path: data/eidc_rag_test_sample.csv
      hash: md5
      md5: a371d83c5822d256286e80d64d58c3fe
      size: 7524
  fetch-supporting-docs:
    cmd: echo "Fetch supporitng docs from legilo" > data/supporting-docs.json
    outs:
    - path: data/supporting-docs.json
      hash: md5
      md5: 0febface6f1d23fda46c11bef65284f4
      size: 34
  evaluate:
    cmd: python scripts/evaluate.py data/evaluation_data.csv -m data/metrics.json
      -img data/eval.png
    deps:
    - path: data/evaluation_data.csv
      hash: md5
      md5: f6bce3f5c551e84da224d36201858839
      size: 6638
    - path: scripts/evaluate.py
      hash: md5
      md5: 10f76511eafc8a1a9b90e9ae92a76bc5
      size: 2633
    outs:
    - path: data/eval.png
      hash: md5
      md5: fd66aa842f93e8f370399dae5b68e2fe
      size: 50525
    - path: data/metrics.json
      hash: md5
      md5: 55266ae1bd64a3499508d07651a5aa13
      size: 214
