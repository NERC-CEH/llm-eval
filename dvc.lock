schema: '2.0'
stages:
  fetch-metadata:
    cmd: python scripts/fetch_eidc_metadata.py data/eidc_metadata.json -s 3
    deps:
    - path: scripts/fetch_eidc_metadata.py
      hash: md5
      md5: a564cb0804b482ef09658f0cb4a0a705
      size: 941
    outs:
    - path: data/eidc_metadata.json
      hash: md5
      md5: 068ae066ea08ee369c505c8640481cf6
      size: 125674
  prepare:
    cmd: python scripts/extract_metadata.py data/eidc_metadata.json data/extracted_metadata.json
    deps:
    - path: data/eidc_metadata.json
      hash: md5
      md5: 423dc3a61ede72e1d5c818d74277c0b4
      size: 12140491
    - path: scripts/extract_metadata.py
      hash: md5
      md5: c2fa7d2c4b8f28a6e24536ce0df244fd
      size: 1296
    outs:
    - path: data/extracted_metadata.json
      hash: md5
      md5: 7d2ae8d6a41a960592f30496eb498af7
      size: 4578493
  extract-metadata:
    cmd: python scripts/extract_metadata.py data/eidc_metadata.json data/extracted_metadata.json
    deps:
    - path: data/eidc_metadata.json
      hash: md5
      md5: 068ae066ea08ee369c505c8640481cf6
      size: 125674
    - path: scripts/extract_metadata.py
      hash: md5
      md5: e66f21369c5106eaaad4476612c6fb5e
      size: 1313
    outs:
    - path: data/extracted_metadata.json
      hash: md5
      md5: e71f887d993834e3bda1eb00e711e724
      size: 7005
  chunk-data:
    cmd: python scripts/chunk_data.py -o data/chunked_data.json -c 500 -ol 100 data/extracted_metadata.json
      data/supporting-docs.json
    deps:
    - path: data/extracted_metadata.json
      hash: md5
      md5: e71f887d993834e3bda1eb00e711e724
      size: 7005
    - path: data/supporting-docs.json
      hash: md5
      md5: bdab1ea8df4a87aa3d314044eb2eaa0a
      size: 188762
    - path: scripts/chunk_data.py
      hash: md5
      md5: e8de02d6b14c8fc22533d0becfb7d35d
      size: 2198
    outs:
    - path: data/chunked_data.json
      hash: md5
      md5: a01ff8ed4d429203d6903466d26937ff
      size: 320740
  create-embeddings:
    cmd: python scripts/create_embeddings.py data/chunked_data.json data/embeddings.json
    deps:
    - path: data/chunked_data.json
      hash: md5
      md5: a01ff8ed4d429203d6903466d26937ff
      size: 320740
    - path: scripts/create_embeddings.py
      hash: md5
      md5: d9282fc92ed400855c4fc2a290289f14
      size: 867
    outs:
    - path: data/embeddings.json
      hash: md5
      md5: 363e3eaf7f8baddf9aa2e83f45f074b1
      size: 4345553
  upload-to-docstore:
    cmd: python scripts/upload_to_docstore.py data/embeddings.json -o data/chroma-data
      -em all-MiniLM-L6-v2 -c eidc-data
    deps:
    - path: data/embeddings.json
      hash: md5
      md5: 363e3eaf7f8baddf9aa2e83f45f074b1
      size: 4345553
    - path: scripts/upload_to_docstore.py
      hash: md5
      md5: 7b9433047ff175d5e6af8d6056caf05b
      size: 1931
    outs:
    - path: data/chroma-data
      hash: md5
      md5: 39b81f6d319a02523fbc356dd667b920.dir
      size: 5702372
      nfiles: 5
  run-rag-pipeline:
    cmd: python scripts/run_rag_pipeline.py data/eidc_rag_test_sample.csv data/evaluation_data.csv
      data/chroma-data -c eidc-data
    deps:
    - path: data/chroma-data
      hash: md5
      md5: 39b81f6d319a02523fbc356dd667b920.dir
      size: 5702372
      nfiles: 5
    - path: data/eidc_rag_test_sample.csv
      hash: md5
      md5: a371d83c5822d256286e80d64d58c3fe
      size: 7524
    - path: scripts/run_rag_pipeline.py
      hash: md5
      md5: ea2b8d94ee42499870d925f916982e8a
      size: 3781
    outs:
    - path: data/evaluation_data.csv
      hash: md5
      md5: a4470a84d2de8b1d04c7d2dfd8b5f807
      size: 9859
  generate-testset:
    cmd: cp data/synthetic-datasets/eidc_rag_test_sample.csv data/
    outs:
    - path: data/eidc_rag_test_sample.csv
      hash: md5
      md5: a371d83c5822d256286e80d64d58c3fe
      size: 7524
  fetch-supporting-docs:
    cmd: python scripts/fetch_supporting_docs.py data/eidc_metadata.json data/supporting-docs.json
    deps:
    - path: data/eidc_metadata.json
      hash: md5
      md5: 068ae066ea08ee369c505c8640481cf6
      size: 125674
    - path: scripts/fetch_supporting_docs.py
      hash: md5
      md5: 02b94a2cc7bff711784cbdec3650b618
      size: 1718
    outs:
    - path: data/supporting-docs.json
      hash: md5
      md5: bdab1ea8df4a87aa3d314044eb2eaa0a
      size: 188762
  evaluate:
    cmd: python scripts/evaluate.py data/evaluation_data.csv -m data/metrics.json
      -img data/eval.png
    deps:
    - path: data/evaluation_data.csv
      hash: md5
      md5: a4470a84d2de8b1d04c7d2dfd8b5f807
      size: 9859
    - path: scripts/evaluate.py
      hash: md5
      md5: a9c4c04157007c12c068aacdf5e099a9
      size: 2634
    outs:
    - path: data/eval.png
      hash: md5
      md5: 981434fb5f4e61ce4288a4431f70bcc1
      size: 67852
    - path: data/metrics.json
      hash: md5
      md5: 20efb8ebf0d6908f0ee7b35dbff2e7c7
      size: 242
