schema: '2.0'
stages:
  fetch-metadata:
    cmd: python scripts/fetch_eidc_metadata.py data/eidc_metadata.json
    deps:
    - path: scripts/fetch_eidc_metadata.py
      hash: md5
      md5: ba838a284da239217d0464f08e0a45ce
      size: 674
    outs:
    - path: data/eidc_metadata.json
      hash: md5
      md5: fc2f9ebe92cbd07eb06ff6e39366fdac
      size: 12146216
  prepare:
    cmd: python scripts/extract_metadata.py data/eidc_metadata.json data/extracted_metadata.json
    deps:
    - path: data/eidc_metadata.json
      hash: md5
      md5: 423dc3a61ede72e1d5c818d74277c0b4
      size: 12140491
    - path: scripts/extract_metadata.py
      hash: md5
      md5: c2fa7d2c4b8f28a6e24536ce0df244fd
      size: 1296
    outs:
    - path: data/extracted_metadata.json
      hash: md5
      md5: 7d2ae8d6a41a960592f30496eb498af7
      size: 4578493
  extract-metadata:
    cmd: python scripts/extract_metadata.py data/eidc_metadata.json data/extracted_metadata.json
    deps:
    - path: data/eidc_metadata.json
      hash: md5
      md5: fc2f9ebe92cbd07eb06ff6e39366fdac
      size: 12146216
    - path: scripts/extract_metadata.py
      hash: md5
      md5: c2fa7d2c4b8f28a6e24536ce0df244fd
      size: 1296
    outs:
    - path: data/extracted_metadata.json
      hash: md5
      md5: fce18ce3c43175af1cea5d84dac9baf9
      size: 4579965
  chunk-data:
    cmd: python scripts/chunk_data.py -o data/chunked_data.json -c 300 -ol 100 -s
      10 data/extracted_metadata.json
    deps:
    - path: data/extracted_metadata.json
      hash: md5
      md5: fce18ce3c43175af1cea5d84dac9baf9
      size: 4579965
    - path: data/supporting-docs.json
      hash: md5
      md5: 0febface6f1d23fda46c11bef65284f4
      size: 34
    - path: scripts/chunk_data.py
      hash: md5
      md5: 681528e4aa1dc8cfb5fe5e5472e25fdf
      size: 2509
    outs:
    - path: data/chunked_data.json
      hash: md5
      md5: e9160d8c6c0fa7f647c5baa03bd1b5dd
      size: 14947
  create-embeddings:
    cmd: python scripts/create_embeddings.py data/chunked_data.json data/embeddings.json
    deps:
    - path: data/chunked_data.json
      hash: md5
      md5: e9160d8c6c0fa7f647c5baa03bd1b5dd
      size: 14947
    - path: scripts/create_embeddings.py
      hash: md5
      md5: 3dc6ef284730398375a13df4bff41846
      size: 808
    outs:
    - path: data/embeddings.json
      hash: md5
      md5: b08299369d1f243eb8d8ffa2cdb9a90f
      size: 351126
  upload-to-docstore:
    cmd: python scripts/upload_to_docstore.py data/embeddings.json -o data/chroma-data
      -em all-MiniLM-L6-v2
    deps:
    - path: data/embeddings.json
      hash: md5
      md5: b08299369d1f243eb8d8ffa2cdb9a90f
      size: 351126
    - path: scripts/upload_to_docstore.py
      hash: md5
      md5: ae8755770166dd3d6c1efb9f15723116
      size: 1836
    outs:
    - path: data/chroma-data
      hash: md5
      md5: 2f2ba629bf078284bb6d6be73c6166a7.dir
      size: 2069220
      nfiles: 5
  run-rag-pipeline:
    cmd: python scripts/run_rag_pipeline.py data/eidc_rag_test_sample.csv data/evaluation_data.csv
    deps:
    - path: data/chroma-data
      hash: md5
      md5: 0254e85bb660da611cfa14e5221dae92.dir
      size: 2069220
      nfiles: 5
    - path: data/eidc_rag_test_sample.csv
      hash: md5
      md5: a371d83c5822d256286e80d64d58c3fe
      size: 7524
    - path: scripts/run_rag_pipeline.py
      hash: md5
      md5: 6d1f49fa8b22288ecd50ed0e3898fd60
      size: 3153
    outs:
    - path: data/evaluation_data.csv
      hash: md5
      md5: 47a0adeb2ee1cb67202048684064d30f
      size: 7293
  generate-testset:
    cmd: cp data/synthetic-datasets/eidc_rag_test_sample.csv data/
    outs:
    - path: data/eidc_rag_test_sample.csv
      hash: md5
      md5: a371d83c5822d256286e80d64d58c3fe
      size: 7524
  fetch-supporting-docs:
    cmd: echo "Fetch supporitng docs from legilo" > data/supporting-docs.json
    outs:
    - path: data/supporting-docs.json
      hash: md5
      md5: 0febface6f1d23fda46c11bef65284f4
      size: 34
  evaluate:
    cmd: python scripts/evaluate.py data/evaluation_data.csv -m data/metrics.json
      -img data/eval.png
    deps:
    - path: data/evaluation_data.csv
      hash: md5
      md5: 47a0adeb2ee1cb67202048684064d30f
      size: 7293
    - path: scripts/evaluate.py
      hash: md5
      md5: 51f036b805f23dd3ebfd5d819bc9d457
      size: 2489
    outs:
    - path: data/eval.png
      hash: md5
      md5: 8c11f987449f8718b6f6011078b6c259
      size: 49498
    - path: data/metrics.json
      hash: md5
      md5: 53fba29cb236fedd3c6446ea94fea3cc
      size: 215
