schema: '2.0'
stages:
  fetch-metadata:
    cmd: python scripts/fetch_eidc_metadata.py data/eidc_metadata.json -s 2000
    deps:
    - path: scripts/fetch_eidc_metadata.py
      hash: md5
      md5: 82907434d9521996e30014df01bbba8e
      size: 964
    outs:
    - path: data/eidc_metadata.json
      hash: md5
      md5: 828442e08598fb258894f9d414943330
      size: 12247809
  prepare:
    cmd: python scripts/extract_metadata.py data/eidc_metadata.json data/extracted_metadata.json
    deps:
    - path: data/eidc_metadata.json
      hash: md5
      md5: 423dc3a61ede72e1d5c818d74277c0b4
      size: 12140491
    - path: scripts/extract_metadata.py
      hash: md5
      md5: c2fa7d2c4b8f28a6e24536ce0df244fd
      size: 1296
    outs:
    - path: data/extracted_metadata.json
      hash: md5
      md5: 7d2ae8d6a41a960592f30496eb498af7
      size: 4578493
  extract-metadata:
    cmd: python scripts/extract_metadata.py data/eidc_metadata.json data/extracted_metadata.json
    deps:
    - path: data/eidc_metadata.json
      hash: md5
      md5: 828442e08598fb258894f9d414943330
      size: 12247809
    - path: scripts/extract_metadata.py
      hash: md5
      md5: e66f21369c5106eaaad4476612c6fb5e
      size: 1313
    outs:
    - path: data/extracted_metadata.json
      hash: md5
      md5: f6123510b2b337bc8a2b6a7180e54b36
      size: 4606527
  chunk-data:
    cmd: python scripts/chunk_data.py -o data/chunked_data.json -c 250 -ol 75 data/extracted_metadata.json
      data/supporting-docs.json -m 250
    deps:
    - path: data/extracted_metadata.json
      hash: md5
      md5: f6123510b2b337bc8a2b6a7180e54b36
      size: 4606527
    - path: data/supporting-docs.json
      hash: md5
      md5: 9144618bb329984fcd622811a7eac3bb
      size: 72280322
    - path: scripts/chunk_data.py
      hash: md5
      md5: 3ad449140b03e1c2904b22a5b401a12e
      size: 2705
    outs:
    - path: data/chunked_data.json
      hash: md5
      md5: 39990a40f23e70dc78424ce0bc408983
      size: 124484286
  create-embeddings:
    cmd: python scripts/create_embeddings.py data/chunked_data.json data/embeddings.json
    deps:
    - path: data/chunked_data.json
      hash: md5
      md5: 39990a40f23e70dc78424ce0bc408983
      size: 124484286
    - path: scripts/create_embeddings.py
      hash: md5
      md5: fa4627c83a65af2e3ea9b2b749f1b29d
      size: 952
    outs:
    - path: data/embeddings.json
      hash: md5
      md5: 8971ce1f4d4ade1507b9a469656c36d0
      size: 1706778742
  upload-to-docstore:
    cmd: python scripts/upload_to_docstore.py data/embeddings.json -o data/chroma-data
      -em all-MiniLM-L6-v2 -c eidc-data
    deps:
    - path: data/embeddings.json
      hash: md5
      md5: 8971ce1f4d4ade1507b9a469656c36d0
      size: 1706778742
    - path: scripts/upload_to_docstore.py
      hash: md5
      md5: 645bdeb372bc79fa7a2e3d8a9eac0d4c
      size: 2330
    outs:
    - path: data/chroma-data
      hash: md5
      md5: 7d158df1ea32a09783259b756f468666.dir
      size: 1126480472
      nfiles: 6
  run-rag-pipeline:
    cmd: python scripts/run_rag_pipeline.py data/eidc_rag_test_set.csv data/evaluation_data.csv
      data/chroma-data -c eidc-data
    deps:
    - path: data/chroma-data
      hash: md5
      md5: 7d158df1ea32a09783259b756f468666.dir
      size: 1126480472
      nfiles: 6
    - path: data/eidc_rag_test_set.csv
      hash: md5
      md5: f301e759e74ce5e71b50e04993ec8c88
      size: 144597
    - path: scripts/run_rag_pipeline.py
      hash: md5
      md5: 0be13da9adedc1c0dad4837523893061
      size: 3869
    outs:
    - path: data/evaluation_data.csv
      hash: md5
      md5: 61fc8879585c0385277ebdc8a6b82420
      size: 203253
  generate-testset:
    cmd: cp data/synthetic-datasets/eidc_rag_test_set.csv data/
    outs:
    - path: data/eidc_rag_test_set.csv
      hash: md5
      md5: f301e759e74ce5e71b50e04993ec8c88
      size: 144597
  fetch-supporting-docs:
    cmd: python scripts/fetch_supporting_docs.py data/eidc_metadata.json data/supporting-docs.json
    deps:
    - path: data/eidc_metadata.json
      hash: md5
      md5: 828442e08598fb258894f9d414943330
      size: 12247809
    - path: scripts/fetch_supporting_docs.py
      hash: md5
      md5: 02b94a2cc7bff711784cbdec3650b618
      size: 1718
    outs:
    - path: data/supporting-docs.json
      hash: md5
      md5: 9144618bb329984fcd622811a7eac3bb
      size: 72280322
  evaluate:
    cmd: python scripts/evaluate.py data/evaluation_data.csv -m data/metrics.json
      -img data/eval.png
    deps:
    - path: data/evaluation_data.csv
      hash: md5
      md5: 61fc8879585c0385277ebdc8a6b82420
      size: 203253
    - path: scripts/evaluate.py
      hash: md5
      md5: 4154acf8e74c1d8bcd0b0da72af038e0
      size: 2728
    outs:
    - path: data/eval.png
      hash: md5
      md5: 2a1630782c103077959097db4e06b7d8
      size: 83362
    - path: data/metrics.json
      hash: md5
      md5: dfdf0d0bf1519ccfa78f95263d63c231
      size: 285
